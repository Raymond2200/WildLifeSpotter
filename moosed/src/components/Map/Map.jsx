import React, { Component } from 'react'
import mapStyle from './map-style';
import styles from './Map.module.css';

class Map extends Component {
    mapDiv = React.createRef();
    
    setMap() {
        let savedVals = [];
        let spotteds = this.props.spotteds;
        spotteds.forEach((spot) => {
            let animalType = spot.animalType;
            let location = {
                lat: spot.lat, 
                lng: spot.lng}
            let description = spot.description;
            savedVals.push([animalType, location, description]);
        });
        if(this.props.lat && this.props.lng) {
            const location = {
                lat: this.props.lat, 
                lng: this.props.lng}
            const map = new window.google.maps.Map(
                this.mapDiv.current, {
                    zoom: this.props.zoom || 12,
                    center: location, 
                    disableDefaultUI: true,
                    styles: mapStyle,
                    gestureHandling: "greedy"
                }
            );
            // new window.google.maps.Marker({
            //     position: location, 
            //     map: map,
            //     draggable: true,
            //     animation: window.google.maps.Animation.DROP
            // });
            savedVals.forEach((spot) => {
                const contentString =
                    `<div class="pin">` +
                    `<h1 id="animalType">${spot[0]}</h1>` +
                    `<div id="description">${spot[2]}</div>` +
                    `</div>`;
                const infowindow = new window.google.maps.InfoWindow({
                    content: contentString,
                });
                const svgMarker = {
                    path:
                        "M500.489,61.252C492.836,56.843,462.146,40,440,40c-2.807,0-6.936,0.966-10.665,5.566  c-4.798,5.92-7.982,17.716-9.932,29.965c-2.154-4.314-4.14-7.581-5.747-9.188c-6.106-6.106-15.873-6.982-23.224-2.082  c-6.395,4.263-11.285,13.539-5.831,26.784c2.804,6.81,8.579,22.812,12.994,38.984c5.785,21.191,5.568,29.119,5.202,31.563  c-7.648,2.91-26.876,3.301-48.146,2.407c10.706-13.358,16.641-30.314,17.343-49.96c0.708-19.829-4.162-35.428-4.37-36.083  c-1.186-3.737-4.908-6.063-8.784-5.496c-3.804,0.557-37.578,5.773-51.868,17.315c-12.876,10.4-21.611,31.49-25.991,62.707  c-2.842-0.314-5.83-0.482-8.981-0.482h-32c-3.151,0-6.139,0.168-8.982,0.483c-4.38-31.217-13.115-52.307-25.991-62.707  c-14.29-11.542-48.064-16.759-51.868-17.315c-3.876-0.569-7.598,1.758-8.784,5.496c-0.208,0.654-5.078,16.254-4.37,36.083  c0.702,19.646,6.638,36.604,17.344,49.962c-21.269,0.895-40.496,0.502-48.147-2.409c-0.367-2.443-0.583-10.372,5.202-31.563  c4.415-16.172,10.189-32.174,12.994-38.984c5.454-13.246,0.564-22.521-5.831-26.784c-7.351-4.899-17.118-4.024-23.224,2.082  c-1.607,1.607-3.593,4.874-5.747,9.188c-1.95-12.249-5.133-24.045-9.932-29.965C78.936,40.966,74.807,40,72,40  c-22.146,0-52.836,16.843-60.489,21.252C5.159,64.103,0,70.532,0,80c0,8.762,7.03,65.596,16.977,83.831  c10.707,19.628,46.099,26.018,58.42,27.675c6.265,7.655,21.981,16.126,69.026,17.677c5.288,0.174,10.506,0.246,15.507,0.246  c5.201,0,10.161-0.078,14.723-0.197C170.715,215.122,168,222.635,168,232c0,10.884,2.375,16.969,4.471,22.337  C174.364,259.188,176,263.378,176,272c0,42.225,9.563,64.408,16.545,80.604c3.586,8.319,6.188,14.369,6.274,20.422  c-0.702,2.3-1.463,4.681-2.245,7.123c-3.912,12.211-8.346,26.051-7.918,38.62c0.552,16.197,8.872,27.329,24.728,33.086  c1.501,0.545,3.101,0.922,4.745,1.177c3.567,6.534,13.3,18.549,36.778,18.957c0.138,0.007,0.276,0.011,0.416,0.011h0.817  c0.14,0,0.278-0.003,0.416-0.011c23.589-0.409,33.305-12.539,36.831-19.05c1.439-0.251,2.838-0.603,4.162-1.083  c15.938-5.787,24.36-17,25.034-33.33c0.523-12.695-3.818-26.644-7.648-38.95c-0.421-1.353-0.836-2.688-1.239-4  c0.207-0.711,0.324-1.461,0.324-2.24c0-6.214,2.545-12.345,6.067-20.831C326.802,336.326,336,314.169,336,272  c0-8.622,1.636-12.812,3.529-17.663C341.625,248.969,344,242.884,344,232c0-9.365-2.715-16.878-6.654-22.768  c4.563,0.119,9.522,0.196,14.723,0.196c5,0,10.221-0.071,15.507-0.246c47.045-1.551,62.762-10.021,69.026-17.677  c12.321-1.658,47.714-8.047,58.42-27.676C504.97,145.596,512,88.762,512,80C512,70.532,506.841,64.103,500.489,61.252z   M79.116,109.839c-0.872,2.689-1.694,5.347-2.449,7.92c-6.959,23.715-9.522,42.621-7.686,56.478  c-15.192-3.016-33.082-9.129-37.958-18.069C22.992,141.446,16,87.083,16,80c0-1.613,0.391-2.812,1.115-3.556  c0.303-0.134,0.602-0.281,0.893-0.457c0.169-0.102,0.357-0.212,0.539-0.32c0.154-0.034,0.306-0.071,0.473-0.084  c1.903-0.15,4.394,1.241,5.074,5.64c8.915,57.65,13.461,71.866,24.322,76.055c4.124,1.591,8.753-0.463,10.343-4.585  c1.554-4.029-0.372-8.543-4.308-10.23c-0.588-0.56-2.744-3.308-5.709-15.243c-2.494-10.037-5.136-24.523-8.834-48.441  c-0.741-4.794-2.568-8.668-5.019-11.663c11.3-5.3,25.208-10.613,35.658-11.081c1.534,2.227,4.673,9.591,6.922,26.369  C79.132,94.823,79.403,105.793,79.116,109.839z M317.027,102.224c7.407-5.983,25.41-10.46,36.975-12.694  c2.969,14.879,6.66,50.978-20.538,73.222c-5.02-0.374-9.979-0.793-14.763-1.247c0.83-5.818,2.626-14.625,7.469-27.73  c1.532-4.145-0.586-8.746-4.731-10.277c-4.142-1.531-8.746,0.586-10.277,4.73c-5.493,14.862-7.484,25.111-8.379,31.597  c-1.906-1.287-3.97-2.415-6.19-3.385C301.224,121.602,310.226,107.717,317.027,102.224z M156.013,113.933  c-0.403-9.901,0.85-18.705,1.989-24.403c11.566,2.235,29.565,6.711,36.972,12.694c6.801,5.493,15.803,19.378,20.434,54.215  c-2.221,0.97-4.284,2.098-6.19,3.385c-0.896-6.486-2.887-16.735-8.379-31.597c-1.532-4.143-6.133-6.263-10.277-4.73  c-4.145,1.532-6.263,6.133-4.731,10.277c4.843,13.106,6.64,21.913,7.469,27.731c-4.782,0.454-9.739,0.874-14.757,1.247  C164.45,151.256,156.865,134.855,156.013,113.933z M144.829,193.188c-49.534-1.648-56.757-10.972-57.703-12.824  c-4.813-9.435-3.167-30.138,4.516-56.801c0.66-2.289,1.337-4.531,2.024-6.719c0.438-0.735,0.77-1.55,0.957-2.435  c0.064-0.303,0.121-0.675,0.173-1.081c6.2-18.915,12.904-33.059,14.958-35.76c0.697-0.575,2.054-0.583,2.937,0.006  c1.707,1.137,1.073,4.558-0.089,7.379c-3.401,8.259-10.155,27.154-14.824,45.354c-6.948,27.087-6.248,40.046,2.417,44.73  c16.129,8.719,68.758,4.935,95.444,2.326c-1.693,4.457-2.796,9.496-3.305,15.116C182.575,193.034,163.96,193.822,144.829,193.188z   M255.732,455.999c-8.262-0.063-13.787-2.022-17.44-4.324c1.342-0.308,2.443-0.597,3.195-0.807c4.261-1.19,8.141-1.769,11.861-1.769  h4.237c3.719,0,7.599,0.579,11.86,1.769c0.832,0.232,2.085,0.561,3.628,0.905C269.426,454.026,263.923,455.937,255.732,455.999z   M324.625,248.519C322.457,254.072,320,260.366,320,272c0,38.598-8.324,59.029-14.507,73.926  c-3.104-7.978-7.601-17.544-13.49-28.667c-0.549-1.037-1.083-2.036-1.6-3.005C283.477,301.283,280,294.772,280,272.5  c0-4.418-3.582-8-8-8s-8,3.582-8,8c0,26.276,4.889,35.432,12.29,49.291c0.509,0.953,1.034,1.936,1.573,2.955  c14.208,26.836,16.431,37.519,16.727,40.866c0.033,0.376,0.075,0.844,0.197,1.411c1.167,5.408,2.966,11.188,4.871,17.308  c8.654,27.805,12.463,45.212-7.569,52.485c-2.911,1.058-10.146,0.93-18.339-1.358c-5.682-1.587-10.969-2.358-16.164-2.358h-4.237  c-5.195,0-10.482,0.771-16.165,2.358c-8.194,2.288-15.429,2.415-18.339,1.359c-19.738-7.167-15.825-24.345-7.033-51.785  c2.041-6.37,3.968-12.387,5.181-18.008c0.169-0.784,0.192-1.431,0.209-1.903c0.12-3.354,1.907-14.002,15.869-40.375  c0.977-1.845,1.919-3.567,2.821-5.216C242.656,307.16,248,297.39,248,272.5c0-4.418-3.582-8-8-8s-8,3.582-8,8  c0,20.8-3.819,27.783-10.146,39.352c-0.935,1.709-1.911,3.495-2.924,5.407c-5.445,10.285-9.637,19.273-12.582,26.942  C200.025,329.458,192,309.158,192,272c0-11.634-2.457-17.928-4.625-23.481C185.49,243.688,184,239.872,184,232  c0-18.676,16.245-23.761,18.042-24.265c0.029-0.008,0.056-0.019,0.085-0.026c0.107-0.029,0.211-0.064,0.316-0.098  c0.128-0.041,0.256-0.083,0.381-0.131c0.107-0.04,0.212-0.083,0.316-0.127c0.124-0.053,0.245-0.109,0.365-0.167  c0.096-0.047,0.191-0.093,0.286-0.144c0.132-0.071,0.26-0.148,0.388-0.226c0.075-0.046,0.152-0.09,0.226-0.139  c0.199-0.131,0.392-0.269,0.577-0.416c0.003-0.002,0.006-0.005,0.009-0.007c0.185-0.148,0.361-0.305,0.532-0.467  c0.051-0.049,0.098-0.101,0.148-0.151c0.119-0.12,0.236-0.242,0.347-0.369c0.055-0.063,0.108-0.128,0.162-0.193  c0.1-0.121,0.195-0.245,0.288-0.372c0.052-0.071,0.103-0.142,0.152-0.214c0.088-0.129,0.171-0.263,0.251-0.397  c0.044-0.073,0.089-0.145,0.13-0.219c0.088-0.158,0.167-0.32,0.244-0.484c0.025-0.054,0.055-0.106,0.079-0.161  c0.094-0.213,0.178-0.431,0.253-0.652c0.029-0.085,0.052-0.173,0.078-0.26c0.044-0.144,0.086-0.289,0.122-0.436  c0.024-0.1,0.043-0.201,0.064-0.302c0.028-0.141,0.053-0.282,0.074-0.425c0.015-0.102,0.028-0.203,0.039-0.306  c0.017-0.155,0.026-0.312,0.034-0.469c0.004-0.09,0.01-0.18,0.011-0.271c0-0.036,0.004-0.071,0.004-0.106c0-23.028,8.972-32,32-32  h32c23.028,0,32,8.972,32,32c0,0.036,0.004,0.071,0.004,0.106c0.001,0.091,0.007,0.18,0.011,0.271  c0.008,0.157,0.018,0.313,0.034,0.469c0.011,0.103,0.024,0.204,0.039,0.306c0.021,0.143,0.046,0.284,0.074,0.425  c0.021,0.101,0.04,0.203,0.064,0.302c0.036,0.147,0.078,0.292,0.122,0.436c0.026,0.087,0.049,0.174,0.078,0.26  c0.075,0.221,0.159,0.439,0.253,0.652c0.024,0.055,0.053,0.107,0.079,0.161c0.077,0.164,0.156,0.326,0.244,0.484  c0.041,0.074,0.086,0.146,0.13,0.219c0.08,0.135,0.163,0.268,0.251,0.397c0.049,0.073,0.1,0.144,0.152,0.214  c0.092,0.127,0.188,0.25,0.288,0.372c0.053,0.065,0.106,0.13,0.162,0.193c0.111,0.127,0.228,0.25,0.347,0.369  c0.05,0.05,0.097,0.102,0.148,0.151c0.17,0.163,0.347,0.319,0.532,0.467c0.003,0.002,0.006,0.005,0.009,0.007  c0.185,0.147,0.378,0.285,0.577,0.416c0.074,0.049,0.151,0.092,0.226,0.139c0.127,0.078,0.256,0.155,0.388,0.226  c0.094,0.051,0.189,0.097,0.286,0.144c0.12,0.058,0.241,0.114,0.365,0.167c0.104,0.044,0.209,0.087,0.316,0.127  c0.125,0.047,0.252,0.09,0.381,0.131c0.105,0.034,0.209,0.068,0.316,0.098c0.029,0.008,0.056,0.019,0.085,0.026  C310.695,207.93,328,212.718,328,232C328,239.872,326.51,243.688,324.625,248.519z M424.874,180.364  c-0.945,1.852-8.168,11.175-57.703,12.824c-19.134,0.634-37.748-0.155-47.506-0.708c-0.509-5.62-1.612-10.659-3.305-15.116  c26.685,2.609,79.313,6.393,95.444-2.326c8.665-4.684,9.365-17.643,2.417-44.73c-4.668-18.2-11.423-37.094-14.824-45.354  c-1.162-2.822-1.795-6.242-0.089-7.379c0.884-0.589,2.24-0.581,2.937-0.006c2.055,2.702,8.759,16.846,14.958,35.76  c0.053,0.406,0.109,0.778,0.173,1.081c0.187,0.885,0.518,1.7,0.957,2.435c0.688,2.188,1.365,4.43,2.024,6.719  C428.042,150.227,429.688,170.93,424.874,180.364z M480.977,156.169c-4.876,8.939-22.766,15.053-37.958,18.069  c1.836-13.857-0.727-32.763-7.686-56.478c-0.755-2.574-1.578-5.231-2.449-7.92c-0.288-4.046-0.017-15.016,1.648-27.438  c2.249-16.777,5.389-24.142,6.922-26.368c10.43,0.469,24.344,5.786,35.653,11.086c-2.448,2.994-4.272,6.866-5.014,11.657  c-3.698,23.918-6.341,38.405-8.834,48.441c-2.966,11.936-5.121,14.684-5.709,15.243c-3.937,1.687-5.862,6.202-4.308,10.23  c1.589,4.122,6.22,6.176,10.343,4.585c10.86-4.189,15.407-18.405,24.322-76.055c0.68-4.398,3.155-5.789,5.074-5.64  c0.167,0.013,0.318,0.05,0.472,0.083c0.182,0.108,0.37,0.219,0.54,0.321c0.291,0.175,0.59,0.323,0.893,0.457  C495.609,77.188,496,78.387,496,80C496,87.083,489.008,141.446,480.977,156.169z",
                    // fillColor: "blue",
                    fillOpacity: 1,
                    strokeWeight: 0,
                    rotation: 0,
                    scale: 0.1,
                    anchor: new window.google.maps.Point(15, 30),
                  };
                let marker = new window.google.maps.Marker({
                    position: spot[1], 
                    map: map,
                    animation: window.google.maps.Animation.DROP,
                    animalType: spot[0],
                    description: spot[2],
                    icon: svgMarker,
                });
                marker.addListener("click", () => {
                    infowindow.open(map, marker);
                  });
            });
        }
    }
    componentDidMount() {
        this.setMap()
    }
    componentDidUpdate() {
        this.setMap();
    }
    render () {
        return (
            <div>
                <div ref={this.mapDiv} className={styles.Map}></div>
            </div>
        )
    }
}


export default Map;